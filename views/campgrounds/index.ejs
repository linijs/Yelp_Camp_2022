<% layout('./layouts/boilerplate')%>

<div class="container section-spacing">
    <div class="headings">
        <span class="text-muted">What we offer</span>
        <h2 class="text-center">Best parks around Latvia, free to explore.</h2>
        <p class="text-paragraph">
            We produce high-performance, compact homes that let you escape the
            everyday to a space that is good for you and good for the planet.
        </p>
    </div>
</div>

<div id="cluster-map" class="section-spacing"></div>
<div id="map-error" class="alert alert-warning d-none" role="alert">
    There was an issue loading the map. This might be due to an ad blocker or
    security software.
</div>

<div class="container-custom section-spacing mt-2">
    <div class="secondary-heading">
        <h1 class="mb-4">Most popular parks, <br />showcased here</h1>
        <p>
            Built to go virtually anywhere, our models are the starting and
            <br />
            end point for all your adventures.
        </p>
    </div>

    <!-- New horizontal scrollable section -->
    <div class="popular-parks-container">
        <div class="popular-parks-scroll" id="popularParks">
            <% const popularParks = campgrounds.docs.sort(() => 0.5 -
            Math.random()).slice(0, 4); %> <% for (let park of popularParks) {
            %>
            <div class="popular-park-card">
                <div class="lazy-image-container">
                    <div
                        class="lazy-image-placeholder"
                        style="
                            background-image: url('<%= park.images && park.images.length ? park.images[0].url : 'https://res.cloudinary.com/drvf1bwps/image/upload/v1650983178/YelpCamp/yxcc5gwoe16lk7kapphq.jpg' %>');
                        "
                    ></div>
                    <img
                        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="
                        data-src="<%= park.images && park.images.length ? park.images[0].url : 'https://res.cloudinary.com/drvf1bwps/image/upload/v1650983178/YelpCamp/yxcc5gwoe16lk7kapphq.jpg' %>"
                        alt="<%= park.title %>"
                        class="lazy-image loading"
                    />
                </div>
                <div class="popular-park-info">
                    <h3><%= park.title %></h3>
                    <p><%= park.location %></p>
                    <a
                        href="/campgrounds/<%= park._id %>"
                        class="btn btn-primary"
                        >View Details</a
                    >
                </div>
            </div>
            <% } %>
        </div>
    </div>
</div>

<div class="container-custom section-spacing">
    <div class="container mb-4">
        <div class="headings">
            <span class="text-muted" id="all-parks">All parks</span>
            <h2 class="text-center">
                Best parks around Latvia, free to explore.
            </h2>
            <p class="text-paragraph">
                We produce high-performance, compact homes that let you escape
                the everyday to a space that is good for you and good for the
                planet.
            </p>
        </div>
    </div>

    <% if (campgrounds && campgrounds.docs && campgrounds.docs.length > 0) { %>
    <!-- Add the campground display code here -->
    <div class="row">
        <% for(let campground of campgrounds.docs) { %>
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-img-container lazy-image-container">
                    <div
                        class="lazy-image-placeholder"
                        style="
                            background-image: url('<%= campground.images && campground.images.length ? campground.images[0].url : 'https://res.cloudinary.com/drvf1bwps/image/upload/v1650983178/YelpCamp/yxcc5gwoe16lk7kapphq.jpg' %>');
                        "
                    ></div>
                    <img
                        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="
                        data-src="<%= campground.images && campground.images.length ? campground.images[0].url : 'https://res.cloudinary.com/drvf1bwps/image/upload/v1650983178/YelpCamp/yxcc5gwoe16lk7kapphq.jpg' %>"
                        class="card-img-top lazy-image loading"
                        alt="<%= campground.title %>"
                    />
                    <span
                        class="badge bg-primary position-absolute top-0 end-0 m-2"
                    >
                        $<%= campground.price %>/night
                    </span>
                </div>
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title"><%= campground.title %></h5>
                    <p class="card-text text-muted mb-2">
                        <i class="fas fa-map-marker-alt"></i> <%=
                        campground.location %>
                    </p>
                    <p class="card-text flex-grow-1">
                        <%= campground.description.substring(0, 100) %>...
                    </p>
                    <div
                        class="d-flex justify-content-between align-items-end mt-3"
                    >
                        <div class="btn-group">
                            <a
                                href="/campgrounds/<%= campground._id %>"
                                class="btn btn-primary"
                                >View Details</a
                            >
                        </div>
                        <small class="text-muted"
                            ><i class="fas fa-star text-warning"></i> 4.5 (42
                            reviews)</small
                        >
                    </div>
                </div>
            </div>
        </div>
        <% } %>
    </div>

    <% if (campgrounds.totalPages > 1) { %>
    <nav aria-label="Campground pagination">
        <ul class="pagination justify-content-center">
            <% if (campgrounds.hasPrevPage) { %>
            <li class="page-item">
                <a
                    class="page-link"
                    href="/campgrounds?page=<%=campgrounds.prevPage%>#all-parks"
                    aria-label="Previous"
                >
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <% } %> <% if (typeof pageNumbers !== 'undefined' &&
            pageNumbers.length > 0) { %> <% pageNumbers.forEach(number => { %>
            <% if (number === '...') { %>
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
            <% } else { %>
            <li class="page-item <%= number === currentPage ? 'active' : '' %>">
                <a
                    class="page-link"
                    href="/campgrounds?page=<%= number %>#all-parks"
                    ><%= number %></a
                >
            </li>
            <% } %> <% }) %> <% } %> <% if (campgrounds.hasNextPage) { %>
            <li class="page-item">
                <a
                    class="page-link"
                    href="/campgrounds?page=<%=campgrounds.nextPage%>#all-parks"
                    aria-label="Next"
                >
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            <% } %>
        </ul>
    </nav>
    <% } %> <% } else { %>
    <p>No campgrounds found.</p>
    <% } %>
</div>

<!-- Updated "How to Create" section with images -->
<div class="container section-spacing">
    <div class="headings">
        <span class="text-muted">HOW TO CREATE</span>
        <h2 class="text-center">Easy steps to add your park</h2>
        <p class="text-paragraph">
            We produce high-performance, compact homes that let you escape the
            everyday to a space that is good for you and good for the planet.
        </p>
        <div class="row mt-4">
            <div class="col-md-4">
                <div class="card mb-3">
                    <img
                        src="/images/signup-icon.jpg"
                        class="card-img-top"
                        alt="Sign Up or Log In"
                    />
                    <div class="card-body">
                        <h5 class="card-title">1. Sign Up or Log In</h5>
                        <p class="card-text">
                            Create an account or log in to your existing one to
                            get started.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-3">
                    <img
                        src="/images/create-park-icon.jpg"
                        class="card-img-top"
                        alt="Click Create Park"
                    />
                    <div class="card-body">
                        <h5 class="card-title">2. Click "Create Park"</h5>
                        <p class="card-text">
                            Use the button above to access the park creation
                            form.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-3">
                    <img
                        src="/images/fill-details-icon.jpg"
                        class="card-img-top"
                        alt="Fill in the Details"
                    />
                    <div class="card-body">
                        <h5 class="card-title">3. Fill in the Details</h5>
                        <p class="card-text">
                            Provide information about your park, including
                            photos and location.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container section-spacing">
    <div class="headings">
        <span class="text-muted">CREATE</span>
        <h2 class="text-center">Want to add your own discoveries?</h2>
        <div class="text-center mt-3">
            <a href="/campgrounds/new" class="btn btn-secondary btn-lg"
                >Create Park</a
            >
        </div>
    </div>
</div>

<script>
    const mapToken = '<%-process.env.MAPBOX_TOKEN%>';
    const campgrounds = { features: <%- JSON.stringify(campgrounds && campgrounds.docs ? campgrounds.docs : []) %> };
</script>

<script src="/javascripts/lazyLoading.js"></script>
<script src="/javascripts/smoothScroll.js"></script>
<script src="/javascripts/popularParksSlider.js"></script>
<script src="/javascripts/clusterMap.js"></script>
